<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mapperタグは必須　namespace属性:Mapperインターフェースの完全修飾名 -->
<mapper namespace="sample.common.dao.mapper.TaskMapper">

	<!-- SQL検索結果のマッピング -->
	<!-- DB列名とJavaのプロパティ名が異なる場合に使用 -->
	<!-- id:任意名  type:SQLの結果をマッピングするJavaクラスを指定 -->
	<resultMap id="TaskResultMap"
		type="sample.common.dao.entity.Task">
		<!-- property:Javaのフィールド名  column:SQLの列名 -->
		<id property="id" column="id" />
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="name" column="name" />
		<result property="username" column="username" />
		<result property="startDate" column="start_date" />
		<result property="endDate" column="end_date" />
		<result property="createdAt" column="created_at" />
		<result property="updatedAt" column="updated_at" />
	</resultMap>
	
	
	<!-- ページング対応タスク一覧取得 -->
	<select id="findPagedByUsername" resultMap="TaskResultMap">
		SELECT id, title, content, name, username, start_date, end_date,
		created_at,
		updated_at
		FROM tasks
		WHERE username = #{username}
		ORDER BY id DESC
		<!-- LIMIT:1ページで取得する件数　OFFSET:取得開始位置(スキップする件数) -->
		LIMIT #{size} OFFSET #{offset}
	</select>
	
	
	<!-- タスク総件数の取得 -->
	<select id="countAllByUsername" resultType="int">
		SELECT COUNT(*)
		FROM tasks
		WHERE username = #{username}
	</select>
	
	
	<!-- 単一タスクの取得(ID指定) -->
	<select id="findById" resultMap="TaskResultMap">
		SELECT id, title, content, name, username, start_date, end_date, created_at,
		updated_at
		FROM tasks
		WHERE id = #{id}
	</select>
	
	
	<!-- タスクの新規登録 -->
	<insert id="insertTask"
		parameterType="sample.common.dao.entity.Task">
		INSERT INTO tasks(title, content, username, name, start_date, end_date,
		created_at,updated_at)
		VALUES (#{title}, #{content}, #{username}, #{name}, #{startDate}, #{endDate}, NOW(),
		NOW())
	</insert>
	
	
	<!-- タスクの更新 -->
	<update id="update">
		UPDATE tasks
		SET title = #{task.title},
		content = #{task.content},
		name = #{task.name},
		start_date = #{task.startDate},
		end_date = #{task.endDate},
		updated_at = NOW()
		WHERE id = #{task.id} AND username = #{username}
	</update>
	
	
	<!-- タスクの削除 -->
	<delete id="delete">
		DELETE FROM tasks
		WHERE id = #{id} AND username = #{username}
	</delete>

</mapper>
